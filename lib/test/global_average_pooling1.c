#include "test/global_average_pooling1.h"

#include "test/util.h"
#include "test/assert.h"
#include "matutil.h"

int test_random_1()
{
    int steps = 10;
    int channels = 3;

    float inputs[] = {-0.922, -0.385, 0.492, 0.185, -0.587, 0.595, 0.234, 0.165, -0.519, -0.325, 0.0436, -0.698, -0.213, 0.552, -0.817, -0.225, -0.762, -0.958, 0.733, -0.24, -0.268, 0.434, -0.102, -0.395, -0.505, -0.685, -0.144, 0.154, 0.477, -0.553};
    float expected[] = {-0.045, -0.152, -0.326};

    float ret[channels];
    matutil_global_average_pooling_1d(inputs, steps, channels, ret);
    return print_result("GAP1 random 1", assert_similarity(expected, ret, channels));
}

int test_random_2()
{
    int steps = 10;
    int channels = 3;

    float inputs[] = {0.956, -0.693, -0.388, -0.99, 0.804, 0.566, 0.551, -0.879, 0.242, 0.684, -0.269, -0.207, 0.0842, 0.349, 0.339, -0.291, -0.272, 0.322, 0.774, 0.276, -0.941, -0.309, -0.155, -0.494, 0.944, -0.741, -0.265, -0.246, 0.164, 0.45};
    float expected[] = {0.216, -0.142, -0.0374};

    float ret[channels];
    matutil_global_average_pooling_1d(inputs, steps, channels, ret);
    return print_result("GAP1 random 2", assert_similarity(expected, ret, channels));
}

int test_random_3()
{
    int steps = 50;
    int channels = 10;

    float inputs[] = {-0.818, -0.937, -0.936, 0.637, -0.196, 0.784, 0.954, -0.0577, -0.68, 0.493, -0.541, 0.798, -0.133, 0.71, -0.249, -0.162, -0.182, -0.337, -0.862, -0.11, -0.826, -0.826, 0.497, -0.796, -0.148, 0.994, -0.577, -0.898, 0.31, 0.978, 0.966, -0.793, 0.435, -0.502, -0.294, -0.904, -0.767, 0.439, -0.725, 0.329, 0.526, -0.505, -0.897, 0.358, 0.641, -0.853, 0.816, -0.193, 0.428, 0.778, 0.498, -0.789, 0.628, -0.386, 0.26, 0.586, -0.203, -0.753, 0.856, 0.374, -0.282, 0.735, -0.503, 0.782, -0.403, 0.396, -0.0123, 0.676, -0.154, 0.0155, 0.611, 0.0237, -0.943, -0.932, 0.495, -0.409, -0.594, -0.168, 0.96, 0.532, -0.979, 0.104, 0.42, 0.806, -0.988, 0.173, -0.354, 0.213, 0.851, -0.516, -0.0867, -0.816, -0.363, 0.666, -0.962, 0.0855, 0.747, 0.102, 0.413, 0.432, -0.308, 0.776, -0.479, 0.722, 0.274, 0.119, 0.37, 0.238, -0.447, 0.515, -0.703, -0.482, 0.476, 0.751, 0.78, -0.592, -0.0493, -0.725, -0.651, 0.784, 0.252, -0.751, -0.29, 0.238, 0.122, -0.858, 0.146, 0.595, -0.522, 0.061, -0.907, 0.472, 0.27, 0.49, -0.436, -0.528, 0.157, 0.712, -0.731, 0.811, -0.956, -0.72, -0.207, 0.408, -0.432, 0.0769, 0.371, -0.134, -0.7, 0.181, 0.702, -0.808, -0.746, -0.751, 0.752, -0.0579, 0.467, 0.227, -0.666, -0.73, 0.136, -0.803, -0.317, -0.549, 0.204, 0.887, 0.38, 0.0837, 0.312, -0.836, 0.0471, 0.269, -0.936, -0.768, 0.0206, 0.42, -0.572, -0.924, -0.626, 0.285, -0.754, -0.0478, 0.428, 0.599, 0.131, -0.673, 0.689, 0.89, 0.583, -0.962, -0.467, 0.497, 0.299, -0.89, 0.292, -0.333, 0.629, -0.455, 0.518, -0.536, 0.689, -0.553, -0.687, -0.901, 0.0503, 0.608, 0.00321, 0.99, 0.928, 0.285, -0.308, 0.0647, 0.0548, 0.308, 0.0101, -0.269, -0.869, 0.939, 0.00324, -0.491, 0.221, 0.352, -0.161, -0.668, -0.907, -0.272, 0.899, -0.0711, -0.839, 0.359, -0.26, -0.0533, 0.178, 0.363, 0.43, 0.38, -0.0433, 0.224, -0.18, 0.585, 0.537, -0.14, 0.149, 0.045, -0.932, -0.439, -0.241, -0.55, -0.671, 0.8, -0.713, 0.495, -0.422, 0.108, 0.61, 0.00466, 0.0992, -0.288, -0.572, 0.501, -0.393, 0.685, 0.876, 0.532, -0.394, -0.0349, -0.448, -0.899, -0.366, -0.845, 0.932, 0.643, -0.661, -0.366, -0.946, 0.161, -0.271, 0.794, 0.857, -0.135, 0.275, 0.994, 0.867, 0.459, -0.874, 0.313, -0.0287, -0.106, 0.17, -0.842, -0.424, -0.794, 0.00728, 0.732, -0.691, -0.48, -0.396, 0.623, -0.386, -0.95, -0.798, 0.693, -0.479, 0.0735, -0.635, -0.977, 0.326, -0.0704, -0.777, 0.525, -0.366, 0.67, 0.82, -0.133, 0.0294, -0.117, 0.304, 0.639, 0.0269, -0.565, -0.61, 0.287, 0.628, -0.714, 0.233, 0.388, -0.384, 0.651, -0.000202, 0.933, -0.312, 0.719, -0.532, 0.0247, -0.559, -0.855, 0.601, 0.188, -0.778, 0.43, 0.0182, 0.228, 0.898, -0.477, -0.0329, -0.374, -0.36, -0.0662, -0.545, 0.819, 0.191, -0.529, 0.0986, -0.402, 0.0453, 0.376, 0.309, -0.0371, 0.39, -0.992, -0.676, 0.938, -0.589, -0.449, -0.0703, -0.0069, 0.939, -0.0611, -0.614, -0.633, 0.188, -0.763, 0.857, -0.387, 0.325, 0.135, 0.99, 0.544, -0.626, 0.498, -0.711, -0.742, 0.383, -0.247, 0.562, -0.131, 0.459, 0.116, -0.864, -0.487, 0.813, -0.384, -0.781, 0.684, -0.869, -0.897, -0.767, 0.691, -0.839, -0.125, -0.452, -0.819, 0.917, -0.769, 0.789, -0.409, -0.087, 0.47, 0.344, 0.391, -0.296, 0.989, 0.627, -0.895, 0.985, -0.64, -0.128, 0.871, -0.9, 0.272, -0.789, -0.479, 0.0192, -0.241, 0.898, -0.827, 0.271, 0.989, 0.127, -0.649, 0.861, -0.982, 0.873, 0.195, -0.572, -0.126, -0.142, 0.561, 0.7, -0.557, -0.67, -0.0961, -0.335, -0.0444, -0.0909, 0.117, -0.622, -0.116, 0.914, -0.232, 0.577, -0.949, -0.237, -0.389, 0.25, -0.302, 0.937, 0.0928, -0.913, 0.65, -0.402, 0.108, 0.728, -0.0955, 0.906, -0.819, -0.233, 0.535, 0.158, -0.94, -0.288, 0.178, -0.522, 0.245, 0.0589, 0.284, -0.0517, 0.622, -0.535, -0.255, -0.387, 0.843, 0.775, -0.769, -0.458, 0.543, -0.897, -0.801, -0.756, -0.757, 0.807, 0.594, -0.428, -0.791, -0.376, 0.559, -0.831, 0.695, 0.953, -0.628};
    float expected[] = {-0.133, -0.0481, 0.0126, -0.0675, -0.0472, -0.0991, 0.0351, 0.154, -0.142, -0.00304};

    float ret[channels];
    matutil_global_average_pooling_1d(inputs, steps, channels, ret);
    return print_result("GAP1 random 3", assert_similarity(expected, ret, channels));
}

void test_global_average_pooling1(int *correct_cases, int *total_cases)
{
    *correct_cases += test_random_1();
    *total_cases += 1;
    *correct_cases += test_random_2();
    *total_cases += 1;
    *correct_cases += test_random_3();
    *total_cases += 1;
}